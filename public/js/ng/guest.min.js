!function(){"use strict";angular.module("nd.guest.authenticate",["nd.guest.login","nd.guest.register","ngSanitize","ngAnimate","ui.bootstrap.showErrors","nd.alerts","nd.focus"]).directive("ndAuthenticate",["GuestLogin","GuestRegister","AlertService",function(a,b,c){return{restrict:"AE",scope:{ndCurrentUser:"=?"},replace:!0,link:function(d,e,f){d.rememberMe=!0,d.usernameAvailable=!0,d.changeMode=function(a){d.mode=a;for(var b=["login","register","forgot"],c=0;c<b.length;c++)d[b[c]+"Focus"]=!1;d[a+"Focus"]=!0},d.changeMode(f.ndAuthenticateMode||"login"),d.login=function(){a.authenticate({login:d.loginUsername,password:d.loginPassword,remember_me:d.rememberMe}).then(function(a){d.ndCurrentUser=a},function(a){var b="Unknown error";d.loginPassword="",a.data&&a.data.message&&(b=a.data.message),c.publish("warning",b,"authentication")})},d.register=function(){b.register({username:d.registerUsername,password:d.registerPassword,email:d.registerEmail}).then(function(a){console.log("Success: ",a)},function(a){console.log("Failed: ",a)})},d.forgot=function(){a.remind({email:d.resetEmail}).then(function(a){d.resetEmail="",c.publish("success",a.data.message,"authentication")},function(a){var b="Unknown error.";d.resetEmail="",a.data&&a.data.message&&(b=a.data.message),c.publish("warning",b,"authentication")})}},templateUrl:"/js/ng/common/guest/authenticate.html"}}])}(),function(){"use strict";angular.module("nd.guest.login",[]).factory("GuestLogin",["$http",function(a){return{authenticate:function(b){return a.post("/sessions",b,{headers:{}})},remind:function(b){return a.post("/password/remind",b,{headers:{}})}}}])}(),function(){"use strict";angular.module("nd.guest.register",[]).factory("GuestRegister",["$http","$q","ErrorMessages","ErrorMessagesExcludedKeys",function(a,b,c,d){c.usernameTaken="This username is already in use",d.push("usernameTaken");var e=[];return{register:function(b){return a.post("/registrations",b,{headers:{}})},usernameAvailable:function(c){for(var d=0;d<e.length;d++){var f=e[d];f.resolve({data:{available:!0}}),e.splice(e.indexOf(f),1)}var g=b.defer();return e.push(g),a.get("registrations/"+c,{headers:{},timeout:g.promise})}}}]).directive("usernameTaken",["GuestRegister","ErrorMessages",function(a){return{require:"ngModel",link:function(b,c,d,e){c.on("keyup",function(){b.$apply(function(){var b=c.val();return b?void a.usernameAvailable(b).success(function(a){e.$setValidity("usernameTaken",a.available)}):void e.$setValidity("usernameTaken",!0)})})}}}])}();
